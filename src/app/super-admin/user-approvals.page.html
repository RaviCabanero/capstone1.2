<div class="page-wrapper ion-padding">
  <div class="approvals-container">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-content">
        <h1>User Approvals</h1>
        <p>Review and manage pending user registrations</p>
      </div>
      <div class="header-stats">
        <div class="stat-badge pending">
          <ion-icon name="time-outline"></ion-icon>
          <span>{{ pendingUsers.length || 0 }} Pending</span>
        </div>
        <div class="stat-badge approved">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
          <span>{{ approvedUsers.length || 0 }} Approved</span>
        </div>
      </div>
    </div>

    <!-- Pending Approvals Section -->
    <ion-card class="section-card">
      <ion-card-header class="section-header">
        <div class="section-title">
          <ion-icon name="time-outline"></ion-icon>
          <h2>Pending Approvals</h2>
        </div>
        <p class="section-subtitle">{{ pendingUsers.length || 0 }} users awaiting review</p>
      </ion-card-header>

      <ion-card-content *ngIf="(pendingUsers$ | async) as users; else noUsers">
        <div *ngIf="users.length > 0" class="table-wrapper">
          <table class="users-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Department</th>
                <th>Registered</th>
                <th class="actions-col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of users" class="user-row">
                <td class="name-cell">
                  <div class="user-name">{{ user.firstName }} {{ user.lastName }}</div>
                </td>
                <td class="email-cell">
                  <a [href]="'mailto:' + user.email" class="email-link">{{ user.email }}</a>
                </td>
                <td class="role-cell">
                  <span class="role-badge" [ngClass]="'role-' + user.role">
                    {{ user.role | titlecase }}
                  </span>
                </td>
                <td class="dept-cell">{{ user.schoolDepartment || '-' }}</td>
                <td class="date-cell">{{ user.createdAt | date: 'MMM dd, yyyy' }}</td>
                <td class="actions-cell">
                  <div class="action-buttons">
                    <ion-button
                      fill="solid"
                      color="success"
                      size="small"
                      (click)="approveUser(user.uid)"
                      [disabled]="approvingUid === user.uid"
                      class="approve-btn"
                    >
                      <ion-icon *ngIf="approvingUid !== user.uid" name="checkmark-outline"></ion-icon>
                      <ion-spinner *ngIf="approvingUid === user.uid" name="crescent"></ion-spinner>
                    </ion-button>
                    <ion-button
                      fill="outline"
                      color="danger"
                      size="small"
                      (click)="rejectUser(user.uid)"
                      [disabled]="rejectingUid === user.uid"
                      class="reject-btn"
                    >
                      <ion-icon *ngIf="rejectingUid !== user.uid" name="close-outline"></ion-icon>
                      <ion-spinner *ngIf="rejectingUid === user.uid" name="crescent"></ion-spinner>
                    </ion-button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ion-card-content>

      <ng-template #noUsers>
        <div class="empty-state">
          <ion-icon name="checkmark-done-circle" class="empty-icon"></ion-icon>
          <h3>All Set!</h3>
          <p>No pending approvals. All users have been reviewed.</p>
        </div>
      </ng-template>
    </ion-card>

    <!-- Approved Users Section -->
    <ion-card class="section-card">
      <ion-card-header class="section-header">
        <div class="section-title">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
          <h2>Approved Users</h2>
        </div>
        <p class="section-subtitle">{{ approvedUsers.length || 0 }} users currently approved</p>
      </ion-card-header>

      <ion-card-content *ngIf="(approvedUsers$ | async) as users; else noApproved">
        <div *ngIf="users.length > 0" class="table-wrapper">
          <table class="users-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Department</th>
                <th>Approved Date</th>
                <th class="actions-col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of users" class="user-row approved-row">
                <td class="name-cell">
                  <div class="user-name">{{ user.firstName }} {{ user.lastName }}</div>
                </td>
                <td class="email-cell">
                  <a [href]="'mailto:' + user.email" class="email-link">{{ user.email }}</a>
                </td>
                <td class="role-cell">
                  <span class="role-badge" [ngClass]="'role-' + user.role">
                    {{ user.role | titlecase }}
                  </span>
                </td>
                <td class="dept-cell">{{ user.schoolDepartment || '-' }}</td>
                <td class="date-cell">{{ user.createdAt | date: 'MMM dd, yyyy' }}</td>
                <td class="actions-cell">
                  <ion-button
                    fill="clear"
                    color="danger"
                    size="small"
                    (click)="rejectApprovedUser(user.uid)"
                    class="delete-btn"
                  >
                    <ion-icon name="trash-outline"></ion-icon>
                  </ion-button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </ion-card-content>

      <ng-template #noApproved>
        <div class="empty-state">
          <ion-icon name="people-outline" class="empty-icon"></ion-icon>
          <h3>No Approved Users</h3>
          <p>Approve users from the pending list above.</p>
        </div>
      </ng-template>
    </ion-card>
  </div>
</div>

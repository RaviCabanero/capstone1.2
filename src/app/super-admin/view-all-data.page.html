<div class="page-wrapper ion-padding">
  <div class="data-container">
    <!-- Loading Spinner -->
    <div class="loading-spinner" *ngIf="isLoading">
      <ion-spinner name="crescent"></ion-spinner>
    </div>

    <!-- Page Header -->
    <div class="page-header" *ngIf="!isLoading">
      <div class="header-content">
        <h1>User Data</h1>
        <p>View and export all user records in your system</p>
      </div>
      <div class="header-stats">
        <div class="stat-badge all-users">
          <ion-icon name="people-outline"></ion-icon>
          <span>{{ filteredUsers.length }} Users</span>
        </div>
      </div>
    </div>

    <!-- Controls Section -->
    <ion-card *ngIf="!isLoading" class="controls-card">
      <div class="controls-content">
        <div class="search-wrapper">
          <ion-icon name="search-outline"></ion-icon>
          <input
            type="text"
            class="search-input"
            placeholder="Search by name or email..."
            [(ngModel)]="searchTerm"
            (ionChange)="onSearchChange()"
          />
        </div>

        <div class="filters-wrapper">
          <div class="filter-group">
            <label>Role:</label>
            <select [(ngModel)]="filterRole" (change)="onFilterChange()" class="filter-select">
              <option value="all">All</option>
              <option value="admin">Admin</option>
              <option value="dept_head">Dept Head</option>
              <option value="alumni">Alumni</option>
            </select>
          </div>

          <div class="filter-group">
            <label>Status:</label>
            <select [(ngModel)]="filterStatus" (change)="onFilterChange()" class="filter-select">
              <option value="all">All</option>
              <option value="pending">Pending</option>
              <option value="approved">Approved</option>
              <option value="rejected">Rejected</option>
            </select>
          </div>

          <button class="export-btn" (click)="exportData()">
            <ion-icon name="download-outline"></ion-icon>
            Export ({{ filteredUsers.length }})
          </button>
        </div>
      </div>
    </ion-card>

    <!-- Data Table -->
    <ion-card *ngIf="!isLoading" class="section-card">
      <div class="table-wrapper" *ngIf="filteredUsers.length > 0; else noData">
        <table class="data-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Status</th>
              <th>Department</th>
              <th class="actions-col">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of filteredUsers">
              <td class="name-cell">
                <div class="user-avatar">
                  <span>{{ (user.firstName.charAt(0) || '') + (user.lastName.charAt(0) || '') }}</span>
                </div>
                <span class="user-name">{{ user.firstName }} {{ user.lastName }}</span>
              </td>
              <td class="email-cell">
                <a [href]="'mailto:' + user.email" class="email-link">{{ user.email }}</a>
              </td>
              <td class="role-cell">
                <span class="role-badge" [ngClass]="'role-' + user.role">{{ user.role }}</span>
              </td>
              <td class="status-cell">
                <span class="status-badge" [ngClass]="'status-' + user.status">{{ user.status }}</span>
              </td>
              <td class="dept-cell">
                <span *ngIf="user.schoolDepartment" class="dept-badge">{{ user.schoolDepartment }}</span>
                <span *ngIf="!user.schoolDepartment" class="dept-none">—</span>
              </td>
              <td class="actions-cell">
                <ion-button fill="clear" size="small" class="view-btn" (click)="openUserDetail(user)">
                  <ion-icon name="information-circle-outline"></ion-icon>
                </ion-button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <ng-template #noData>
        <div class="empty-state">
          <ion-icon name="search-outline" class="empty-icon"></ion-icon>
          <h3>No users found</h3>
          <p>Try adjusting your search or filter criteria</p>
        </div>
      </ng-template>
    </ion-card>
  </div>
</div>

<!-- User Detail Modal -->
<ion-modal #detailModal class="user-detail-modal">
  <ng-template #modalContent>
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button (click)="closeUserDetail()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
        <ion-title>User Details</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-content *ngIf="selectedUser" class="ion-padding">
      <div class="detail-container">
        <!-- User Header -->
        <div class="detail-header">
          <div class="detail-avatar">
            <span>{{ (selectedUser.firstName.charAt(0) || '') + (selectedUser.lastName.charAt(0) || '') }}</span>
          </div>
          <div class="detail-title">
            <h2>{{ selectedUser.firstName }} {{ selectedUser.lastName }}</h2>
            <span class="role-badge" [ngClass]="'role-' + selectedUser.role">{{ selectedUser.role }}</span>
          </div>
        </div>

        <!-- Detail Sections -->
        <div class="detail-section">
          <h3 class="section-title">Personal Information</h3>
          <div class="detail-row">
            <label>First Name</label>
            <span>{{ selectedUser.firstName || '—' }}</span>
          </div>
          <div class="detail-row">
            <label>Last Name</label>
            <span>{{ selectedUser.lastName || '—' }}</span>
          </div>
          <div class="detail-row">
            <label>Email</label>
            <a [href]="'mailto:' + selectedUser.email" class="email-link">{{ selectedUser.email || '—' }}</a>
          </div>
          <div class="detail-row">
            <label>Birthdate</label>
            <span>{{ selectedUser.birthdate || '—' }}</span>
          </div>
          <div class="detail-row">
            <label>Mobile</label>
            <span>{{ selectedUser.mobile || '—' }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3 class="section-title">Academic Information</h3>
          <div class="detail-row">
            <label>Department</label>
            <span *ngIf="selectedUser.schoolDepartment" class="dept-badge">{{ selectedUser.schoolDepartment }}</span>
            <span *ngIf="!selectedUser.schoolDepartment">—</span>
          </div>
          <div class="detail-row">
            <label>Course</label>
            <span>{{ selectedUser.course || '—' }}</span>
          </div>
          <div class="detail-row">
            <label>Year Graduated</label>
            <span>{{ selectedUser.yearGraduated || '—' }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3 class="section-title">Address Information</h3>
          <div class="detail-row">
            <label>Address</label>
            <span>{{ selectedUser.address || '—' }}</span>
          </div>
          <div class="detail-row">
            <label>Province</label>
            <span>{{ selectedUser.province || '—' }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h3 class="section-title">Account Status</h3>
          <div class="detail-row">
            <label>Status</label>
            <span class="status-badge" [ngClass]="'status-' + selectedUser.status">{{ selectedUser.status }}</span>
          </div>
          <div class="detail-row">
            <label>Role</label>
            <span class="role-badge" [ngClass]="'role-' + selectedUser.role">{{ selectedUser.role }}</span>
          </div>
        </div>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>
